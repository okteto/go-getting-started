deploy:
  - kubectl apply -f k8s.yml

dev:
  hello-world:
    image: okteto/golang:1
    command: bash
    sync:
      - .:/usr/src/app
    volumes:
      - /go
      - /root/.cache
    securityContext:
      capabilities:
        add:
          - SYS_PTRACE
    forward:
      - 2345:2345

test:
  unit:
    image: okteto/golang:1
    caches:
      - /go
      - /root/.cache
    commands:
      - go test -v ./...
  coverage:
    image: okteto/golang:1
    artifacts:
      - coverage.out
      - coverage.html
    caches:
      - /go
      - /root/.cache
    commands:
      - go test -v -coverprofile=coverage.out ./...
      - go tool cover -html=coverage.out -o coverage.html
